TODO: Bemerkung: Nummerierung wird noch verbessert wenn fertig.

Schritte Migration:

1. Download und unzip Liferay Version 6.2.0, lege Ordner liferay-portal-6.2.0-ga1 ins ~/code Verzeichnis
-> mkdir lr_migration
-> cd lr_migration/
-> wget http://surfnet.dl.sourceforge.net/project/lportal/Liferay%20Portal/6.2.0%20GA1/liferay-portal-tomcat-6.2.0-ce-ga1-20131101192857659.zip

1.1 download: neues LiferaySdk (Speicherplatz!!!!)
-> mv liferaySdk liferaySdk.old
-> wget http://surfnet.dl.sourceforge.net/project/lportal/Liferay%20Portal/6.2.0%20GA1/liferay-plugins-sdk-6.2.0-ce-ga1-20131101192857659.zip
-> unzip liferay-plugins-sdk-6.2.0-ce-ga1-20131101192857659.zip
-> mv liferay-plugins-sdk-6.2.0 liferaySdk

1.2 Build.props konfigurieren
-> vi liferaySdk/build.properties
=================
javac.compiler=modern
=================
-> build.politaktiv.properties vom alten liferaySdk rüberkopieren

1.3 TODO: Wozu brauchen wir das?
-> git clone https://github.com/liferay/liferay-plugins.git


2.0	Erstelle Backup für Datenbank (Snapshot VM)

2.0.1 Umbennennen: Ordner, der zu Datenbankproblemen beim Update führt:
cd ~/code/liferay-portaol-6.2.0-ce-ga1/data/document_libary/10132/0/wiki/14014
mv Protokoll_20110409_Fachbeirat_verk\?rzt.pdf/ Protokoll_20110409_Fachbeirat_verkuerzt.pdf/



2.1 Lösche aus root@localhost/lportal/TABLE/PollsVote das offensichtliche Duplikat, würde zu Fehlern führen
-> /opt/java/DbVisualizer-8.0.8/dbvis

2.2	Lösche aus root@localhost/lportal/TABLE/DLFileEntry und aus ../DLFileVersion alle Einträge mit mit groupID=11259, würde zu Fehlern führen
-> delete from lportal.DLFileEntry where groupid = '11259';
-> delete from lportal.DLFileVersion where groupid = '11259';

3. Entpacken & Kopiere Dateien von liferay-portal-6.1.0-ga1/data* nach liferay-portal-6.2.0-ga1
-> cd code
-> unzip ../lr_migration/liferay-portal-tomcat-6.2.0-ce-ga1-20131101192857659.zip
-> cp -r liferay-portal-6.1.0-ce-ga1/data/* liferay-portal-6.2.0-ce-ga1/data/

4. Kopiere portal-ext.properties und portal-ide.properties nach liferay-portal-6.2.0-ga1. 
-> cp liferay-portal-6.1.0-ce-ga1/portal-* liferay-portal-6.2.0-ce-ga1/

4.1 Verändere die portal-*.properties dahingehend, 
	dass die Tomcat- und Liferayversionen wieder stimmen. Entferne außerdem permissions.user.check.algorithm=6 aus liferay-ext.properties,
	da veraltet und Server Error wirft (jedoch ohne sichtbare Auswirkungen)

-> vi liferay-portal-6.2.0-ce-ga1/portal-ext.properties
->
hot.deploy.listeners=\
com.liferay.portal.deploy.hot.PluginPackageHotDeployListener,\
com.liferay.portal.deploy.hot.HookHotDeployListener,\
com.liferay.portal.deploy.hot.LayoutTemplateHotDeployListener,\
com.liferay.portal.deploy.hot.PortletHotDeployListener,\
com.liferay.portal.deploy.hot.ThemeHotDeployListener,\
com.liferay.portal.deploy.hot.ThemeLoaderHotDeployListener,\
com.liferay.portal.deploy.hot.MessagingHotDeployListener
->
-> vi liferay-portal-6.2.0-ce-ga1/portal-ide.properties
->
auto.deploy.tomcat.conf.dir=/home/politaktiv/code/liferay-portal-6.2.0-ce-ga1/tomcat-7.0.42/conf/Catalina/localhost

5. Ändere build.politaktiv.properties in liferaySdk dahingehend, dass Liferay- und Tomcatversionen stimmen	
-> vi liferaySdk/build.politaktiv.properties

6. Um AUI-Migration kümmern
6.1 aptitude installieren, g++ installieren (beides benötigt für nodejs)
sudu apt-get install aptitude
sudo aptitude install g++
6.1 nodejs installieren  (benötigt für upgrade tool)
Download von: http://nodejs.org/
cd [nodejsVerzeichnis]
./configure
make
sudo make install
6.2 upgrade tool installieren 
git clone https://github.com/PolitAktiv/liferay-aui-upgrade-tool.git
sudo npm install -g laut
6.2 upgrade tool anwenden
cd [liferaySdk/hooks]
laut -f politaktiv-theme/
(+ evtl empty theme)


6.0	Verändere im look-and-feel.xml die Versionsnummern von politaktiv-layouts, politaktiv-theme und politaktiv-empty-theme, sodass diese mit Liferay 6.2.0+ übereinstimmen

6.1	Wie beschreiben in https://www.themeray.com/de/blog/-/blogs/no-theme-found-for-specified-theme-id-%E2%80%A6-returning-the-default-theme
	wird context.xml-Datei mit antiResourceLocking="true" jeweils ins META-INF der Themes gesetzt. (Da "true" eigentlich etwas seltsam ist, habe ich auch false ausprobiert) 

6.2 Build und gradle deploy
7. Lösche calendar-portlet aus tomcat-7.0.42/webapps, da dieser beim Start fehler wirft (wurde abgesprochen, dass erlaubt) (optional)
8. Erstelle neue Server-Instanz, basierend auf 6.2 und nun Tomcat 7.0.42
9. Starte den Server. Im liferay-portal-6.2.0-ga1/deploy Verzeichnis befinden sich die WARs des layouts und der themes.  
10. Uprade läuft durch, meistens keine Exceptions (nur: ERRORs von Liferay). Nach dem Upgrade jedoch Probleme beim Start. 

